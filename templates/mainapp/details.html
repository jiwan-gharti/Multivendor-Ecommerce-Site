{% extends 'mainapp/base.html' %}
{% load static %}
{% load crispy_forms_filters %}

{% block inlinecss %}
<style>
    .forhover {
        transition: all 0.5s ease;
    }

    .forhover:hover {
        box-shadow: 3px 5px 3px #F0F8FF;
        color: black;
        background: #c6c6ff;

    }

    .rateus-label {
        font-size: 1.2rem;
        font-weight: 600;
        font-family: Aeria;
    }

    .rateus i {
        font-size: 1.7rem;
    }

    .reply {
        display: none;
    }

    .reply-show {
        display: block;
    }

    .comment-details {
        display: inline;
        border: 1px solid red;
    }

    .main-image-layout {
        width: 300px;
        height: 450px;
        overflow: hidden;
        padding: 0 0;
        transition: 1s all ease;
    }

    .container-layout {
        width: 100%;
        height: 100%;
        padding: 0 0;
    }

    .stock {
        position: absolute;
        top: 0;
        right: 100px;
        width: 150px;
        height: 40px;
        font-weight: 600;
        background: #f57224;
        border: none;
        Color: white;
        pointer-events: none;
        font-size: 1.3rem;
        border-radius: 2px;

    }

    .diss {
        border: none;
        Color: white;
        margin-left: 2rem;
        background: #f57224;
        padding: 0.1rem .8rem;
        width: 30px;
        height: 30px;
        font-size: .9rem;
    }
</style>
{% endblock inlinecss %}


{% block content %}


{% comment %} Product Details {% endcomment %}
<div class="container-fluid mt-5">
    {% comment %} image Section {% endcomment %}
    <div class="row mt-sm-3">
        <div class="col-md-5 col-sm-12">
            <div class="col-sm-12 p-1" style="height:600px; width:600px">
                <img src="{{singleProduct.image.url}}" class='main-image container-layout' alt=""
                    style="height:100%; width:100%;">
            </div>

            <div class="row mr-1 mt-sm-4 subproduct">
                <div class="col-sm-4 shadow">
                    <img class='image-fluid image-change-js' width="100%" height="120px"
                            src="{{singleProduct.image.url}}" alt="">
                </div>
                {% for data in singleProduct.productalternativeimage_set.all %}
                    <div class="col-sm-4 shadow">
                        <img class='image-fluid image-change-js' width="100%" height="120px"
                            src="{{data.alternative_image.url}}" alt="">
                    </div>
                {% endfor %}
            </div>
        </div>
        {% comment %} end image Section {% endcomment %}

        {% comment %} description section {% endcomment %}
        <div class="col-md-7 col-sm-12 text-md-left text-sm-center">
            <h2 class="mt-3">{{singleProduct.name | title}}</h2>
            <p class='m-sm-1 text-muted'>{{singleProduct.category.second_level_category | upper}} || BRAND NAME :
                {{singleProduct.category.brand_name | upper}}</p>
                {% comment %} {{singleProduct.get_average_rating.rating_avg}} {% endcomment %}
            
            {% if singleProduct.get_average_rating.rating_avg %}
            
             <div class="review-rating" style="font-size:12px;">
                <i style="color:#FFB656;" class="fa fa-star{% if singleProduct.get_average_rating.rating_avg < 1 %}-o empty{% endif %}"></i>
                <i style="color:#FFB656;" class="fa fa-star{% if singleProduct.get_average_rating.rating_avg < 2 %}-o empty{% endif %}"></i>
                <i style="color:#FFB656;" class="fa fa-star{% if singleProduct.get_average_rating.rating_avg < 3 %}-o empty{% endif %}"></i>
                <i style="color:#FFB656;" class="fa fa-star{% if singleProduct.get_average_rating.rating_avg < 4 %}-o empty{% endif %}"></i>
                <i style="color:#FFB656;" class="fa fa-star{% if singleProduct.get_average_rating.rating_avg < 5 %}-o empty{% endif %}"></i>
                ({{singleProduct.get_average_rating.rating_avg}})
            </div>
            {% else %}
            <div class="review-rating" style="font-size:12px;">
                <i style="color:#FFB656;" class="fa fa-star-o empty"></i>
                <i style="color:#FFB656;" class="fa fa-star-o empty"></i>
                <i style="color:#FFB656;" class="fa fa-star-o empty"></i>
                <i style="color:#FFB656;" class="fa fa-star-o empty"></i>
                <i style="color:#FFB656;" class="fa fa-star-o empty"></i>
            </div> 
            (Not Rated Yet)
            {% endif %}

            <div class="d-block ">
                {% if singleProduct.discount.active %}
                ${{singleProduct.calculate_Discount}}
                <p class="price-tag text-muted">
                    <del class="m-0 mb-0" style="font-size: .7rem;">
                        ${{singleProduct.price}}
                    </del>
                    <span class="diss">{{ singleProduct.discount.discount_percentage }}% OFF</span>
                </p>
                {% else %}
                <p class="mb-0 mt-0 price-tag">
                    <p class='m-sm-1'><strong>$ {{singleProduct.price}}</strong></p>
                </p>
                {% endif %}
            </div>

            <hr>

            <div class="m-sm-3">
                <p><strong>Select Size :</strong></p>
                <div class="form-check form-check-inline pl-sm-0 text-sm-center">
                    <input type="radio" class="form-check-input" id="small" name="materialExampleRadios" checked>
                    <label class="form-check-label small text-uppercase card-link-secondary" for="small">Small</label>
                </div>
                <div class="form-check form-check-inline pl-sm-0">
                    <input type="radio" class="form-check-input" id="medium" name="materialExampleRadios">
                    <label class="form-check-label small text-uppercase card-link-secondary" for="medium">Medium</label>
                </div>
                <div class="form-check form-check-inline pl-sm-0">
                    <input type="radio" class="form-check-input" id="large" name="materialExampleRadios">
                    <label class="form-check-label small text-uppercase card-link-secondary" for="large">Large</label>
                </div>
            </div>

            <div class="def-number-input number-input safari_only m-sm-3">

                {% if singleProduct.availability %}
                <button class="stock mt-sm-5 mt-md-0 mr-sm-0">In Stock</button>
                {% else %}
                <button class="stock mt-sm-5 mt-md-0 mr-sm-0">Out Of Stock</button>
                {% endif %}


                
            </div>
            {% comment %} button {% endcomment %}
            <div class="mt-4">
                {% if request.user.is_authentiated or request.user.is_customer %}
                    <form action="/cart/" method="post" class="d-inline-block">
                        {% csrf_token %}
                        <input id="product_id" type="text" name="detail_item_id" value="{{singleProduct.id}}" hidden>
                        <button type="submit" style="border-radius:2px;"
                            class="bg-primary forhover text-white p-2 border-0 add-to-cart-btn1"><i
                                class='fas fa-shopping-cart pr-2'></i> Add to
                            Cart</button>
                    </form>
                {% else %}
                    <form action="{% url 'wishlist' singleProduct.id %}" method="post" class="d-inline-block">
                        {% csrf_token %}
                        <input id="product_id" type="text" name="detail_item_id" value="{{singleProduct.id}}" hidden>
                        <button type="submit" style="border-radius:2px;"
                            class="bg-primary forhover text-white p-2 border-0 add-to-cart-btn1"><i
                                class='fa fa-heart pr-2'></i> Add to Wishlist
                        </button>
                    </form>
                {% endif %}

                {% comment %} <form action="/removecart/{{}}/" method="post" class="d-inline-block ml-md-3">
                    {% csrf_token %}
                    <input type="text" name="remove_cart_id" value="{{ singleProduct.id }}" hidden>
                    <button type="submit" style="border-radius:2px;"
                        class="bg-danger forhover text-white p-2 border-0"><i class='fas fa-trash-alt pr-2'></i> Remove
                        Item</button>
                </form> {% endcomment %}
            </div>
        </div>
        {% comment %} end description section {% endcomment %}
    </div>
</div>

<div class="container mt-sm-5 mb-sm-5 border">
    <div class="row"  >
        <div class="col-md-12">
            <div class="product-tab border-bottom border-warning">
                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="pills-detail-tab" data-toggle="tab" href="#pills-details" role="tab"
                            aria-controls="pills-details" aria-selected="true">Detail</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="pills-review-tab" data-toggle="tab" href="#pills-review" role="tab"
                            aria-controls="pills-review" aria-selected="false">Review({{comments.count}})</a>
                    </li>
                </ul>
            </div>
            <div class="tab-content mt-5" id="myTabContent">
                <!--Details tab-->
                <div class="tab-pane fade show active" id="pills-details" role="tabpanel" aria-labelledby="pills-detail-tab">
                    {{ singleProduct.description |safe }}
                 </div>
                <!--Review Tab-->
                <div class="tab-pane fade" id="pills-review" role="tabpanel" aria-labelledby="pills-review-tab">
                    <div class="row">
                        <div class="col-md-6" >
                            <div class="product-reviews"  id="comment-section">
                                {% for rs in comments %}
                                
                                <div class="single-review border-bottom" id="comment-box">
                                    <div class="review-heading">
                                                <div><a href="#"><i class="fa fa-user-o"></i> {{rs.user.first_name}}</a></div>
                                                {% comment %} <div style="font-size:14px;"><p>{{rs.subject}}</p></div> {% endcomment %}
                                                {% if rs.sentiment != '0' %}
                                                    <div style="font-size:14px;"><p>&#x1F600</p></div>
                                                {% else %}
                                                    <div style="font-size:14px;"><p>&#x1F641</p></div>
                                                {% endif %}
                                                <div style="font-size:12px;"><p class="text-muted" href="#"><i class="fa fa-clock-o"></i> {{rs.created}}</p></div>
                                            
                                            <div class="review-rating float-right" style="font-size:12px;">
                                                <i class="fa fa-star{% if rs.rate < 1 %}-o empty{% endif %}"></i>
                                                <i class="fa fa-star{% if rs.rate < 2 %}-o empty{% endif %}"></i>
                                                <i class="fa fa-star{% if rs.rate < 3 %}-o empty{% endif %}"></i>
                                                <i class="fa fa-star{% if rs.rate < 4 %}-o empty{% endif %}"></i>
                                                <i class="fa fa-star{% if rs.rate < 5 %}-o empty{% endif %}"></i>
                                            </div>

                                    </div>
                                    <div class="review-body">
                                        <p>{{rs.comment}}</p>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <p class="my-4 text-center"><button id="loadMoreComment" data-limit_comments="3" data-total_comments="{{total_comments}}" class="btn btn-dark btn-sm">Load More <i class="fa fa-sync" id="load-more-comment-icon"></i> </button></p>
                        </div>
                        <div class="col-md-6">
                            <h4 class="text-uppercase">Write Your Review</h4>

                            {% if messages %}
                            {% for message in messages %}
                            <div class="alert alert-{{message.tags}}" role="alert">
                                {{ message }}
                            </div>
                            {% endfor %}
                            {% endif %}

                            <form class="review-form" action="{% url 'add_comment' singleProduct.id %}" method="post">
                                {% csrf_token %}
                                <div class="form-group">
                                    {{forms.subject | as_crispy_field}}
                                    {% comment %} <input name="subject" class="input form-control" type="text"
                                        placeholder="Your subject" /> {% endcomment %}
                                </div>

                                <div class="form-group">
                                    <textarea name="comment" class="input form-control"
                                        placeholder="Your review"></textarea>
                                </div>
                                <div class="form-group">
                                    <div class="input-rating">
                                        <strong class="text-uppercase">Your Rating: </strong>
                                        <div class="stars">
                                            <input type="radio" id="star5" name="rate" value="5" /><label
                                                for="star5"></label>
                                            <input type="radio" id="star4" name="rate" value="4" /><label
                                                for="star4"></label>
                                            <input type="radio" id="star3" name="rate" value="3" /><label
                                                for="star3"></label>
                                            <input type="radio" id="star2" name="rate" value="2" /><label
                                                for="star2"></label>
                                            <input type="radio" id="star1" name="rate" value="1" /><label
                                                for="star1"></label>
                                        </div>
                                    </div>
                                </div>
                                {% if request.user.id is not None %}
                                <button type="submit" class="btn-primary p-1 border" style="backgroud:#f57224">Submit</button>
                                {% else %}
                                You must be logged in to post a review
                                {% endif %}
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="container-fluid mt-5">
    <h5 class='ml-3'>
    People who Viewed This Item Also Viewed
    </h5>
    <hr style="height:4px; bg-gray">

  <div class="row pl-5 d-flex justify-content-left pr-5 margin-auto">
  {% for data in recommend_products %}
    <div class="mr-3 mt-2 mb-2" style="width:250px;">
      <div class="card shadow" style="border:none;">
        <a href="{% url 'details' data.id %}"><img src="{{data.image.url}}" class="card-img-top shadow" alt="..." ></a>
        {% if data.discount.active %}
        <div class="position-absolute top-0 right-0 discount-card">{{data.discount.discount_percentage}}% off
        </div>
        {% endif %}
        <div class="card-body bg-white text-dark overflow-hidden p-2 shadow" style= "height: 8rem">
          <h6 class="mb-auto" class="card-title" style="white-space:none; overflow:hidden; text-overflow:ellipsis">{{data.name | title}}</h6>
          <p style="font-size:0.6rem; margin-bottom:3px;" class="card-text mb-0 mt-sm-0 text-muted">{{data.category.brand_name | title}}</p>
          {% if data.get_average_rating.rating_avg %}
            
             <div class="review-rating" style="font-size:12px;">
                <i style="color:#FFB656;" class="fa fa-star{% if data.get_average_rating.rating_avg < 1 %}-o empty{% endif %}"></i>
                <i style="color:#FFB656;" class="fa fa-star{% if data.get_average_rating.rating_avg < 2 %}-o empty{% endif %}"></i>
                <i style="color:#FFB656;" class="fa fa-star{% if data.get_average_rating.rating_avg < 3 %}-o empty{% endif %}"></i>
                <i style="color:#FFB656;" class="fa fa-star{% if data.get_average_rating.rating_avg < 4 %}-o empty{% endif %}"></i>
                <i style="color:#FFB656;" class="fa fa-star{% if data.get_average_rating.rating_avg < 5 %}-o empty{% endif %}"></i>
                ({{data.get_average_rating.rating_avg | floatformat:1}})
            </div>
            {% else %}
            <div class="review-rating" style="font-size:12px;">
                <i style="color:#FFB656;" class="fa fa-star-o empty"></i>
                <i style="color:#FFB656;" class="fa fa-star-o empty"></i>
                <i style="color:#FFB656;" class="fa fa-star-o empty"></i>
                <i style="color:#FFB656;" class="fa fa-star-o empty"></i>
                <i style="color:#FFB656;" class="fa fa-star-o empty"></i>
            </div>
            {% endif %}
          <div class="d-md-flex justify-content-between mt-sm-1 d-sm-block">
            <div class="d-block ">
              {% if data.discount.active %}
              <p class="mb-0 mt-0 price-tag">
                ${{data.price}}<br> <del class="mt-0 mb-0 text-muted"
                  style="font-size: .7rem;">&nbsp{{data.calculate_Discount}}&nbsp</del></p>
              {% else %}
              <p class="mb-0 mt-0 price-tag">
                ${{data.price}}</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
    </div>
</div>

<script>

</script>

{% endblock content %}